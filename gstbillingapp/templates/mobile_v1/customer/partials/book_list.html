{% load tz %}
{% load humanize %}

{% if books %}
    <div style="padding: 0 8px;">
        {% for book in books %}
            <div class="transaction-item {% if book.is_active %}{% if book.change_type == 0 %}payment{% elif book.change_type == 1 %}purchase{% elif book.change_type == 2 %}return{% elif book.change_type == 3 %}advance{% else %}other{% endif %}{% else %}inactive{% endif %}">
                
                <div class="transaction-header">
                    <div class="transaction-type">
                        <span class="type-badge">
                            {{ book.get_change_type_display }}
                        </span>
                    </div>
                    <div class="transaction-date">
                        {{ book.date|localtime|date:"d M, y" }}
                    </div>
                </div>
                
                <h3 class="transaction-amount">â‚¹{{ book.change|floatformat:2|intcomma }}</h3>
                
                <div class="transaction-meta">
                    <span class="transaction-time">
                        <i class="fas fa-clock"></i> {{ book.date|naturaltime }}
                    </span>
                    {% if book.associated_invoice %}
                        <a href="{% url 'v1customerinvoiceviewer' book.associated_invoice.id %}?cid={{ request.GET.cid }}" 
                           class="transaction-action">
                            <i class="fas fa-eye"></i> View Invoice
                        </a>
                    {% else %}
                        <button class="transaction-action" 
                                onclick="haptic.light(); booknotes('{{ book.description|escapejs }}', '{{ book.createdby|escapejs }}')">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                    {% endif %}
                </div>
                
            </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if books.has_other_pages %}
    <div class="pagination-container">
        <ul class="custom-pagination">

            {% if books.has_previous %}
            <li>
                <a href="#" class="page-btn" onclick="loadBooks({{ books.previous_page_number }}); return false;">
                    <i class="fas fa-chevron-left"></i>
                </a>
            </li>
            {% else %}
            <li>
                <span class="page-btn disabled">
                    <i class="fas fa-chevron-left"></i>
                </span>
            </li>
            {% endif %}

            {% if books.number > 3 %}
                <li><a href="#" class="page-btn" onclick="loadBooks(1); return false;">1</a></li>
                {% if books.number > 4 %}
                    <li><span class="page-btn disabled">...</span></li>
                {% endif %}
            {% endif %}

            {% for num in books.paginator.page_range %}
                {% if num >= books.number|add:-2 and num <= books.number|add:2 %}
                    <li>
                        <a href="#" 
                           class="page-btn {% if books.number == num %}active{% endif %}"
                           onclick="loadBooks({{ num }}); return false;">
                            {{ num }}
                        </a>
                    </li>
                {% endif %}
            {% endfor %}

            {% if books.number < books.paginator.num_pages|add:-2 %}
                {% if books.number < books.paginator.num_pages|add:-3 %}
                    <li><span class="page-btn disabled">...</span></li>
                {% endif %}
                <li><a href="#" class="page-btn" onclick="loadBooks({{ books.paginator.num_pages }}); return false;">{{ books.paginator.num_pages }}</a></li>
            {% endif %}

            {% if books.has_next %}
            <li>
                <a href="#" class="page-btn" onclick="loadBooks({{ books.next_page_number }}); return false;">
                    <i class="fas fa-chevron-right"></i>
                </a>
            </li>
            {% else %}
            <li>
                <span class="page-btn disabled">
                    <i class="fas fa-chevron-right"></i>
                </span>
            </li>
            {% endif %}

        </ul>
    </div>
    {% endif %}

{% else %}
    <!-- Empty State -->
    <div class="empty-state">
        <div class="empty-state-icon">
            <i class="fas fa-book-open"></i>
        </div>
        <h3 class="empty-state-title">No Transactions Found</h3>
        <p class="empty-state-text">There are no transaction records to display at the moment.</p>
    </div>
{% endif %}
