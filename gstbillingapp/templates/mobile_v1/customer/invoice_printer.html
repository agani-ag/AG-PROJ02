{% extends "mobile_v1/print_base.html" %}


{% block content %}

<div class="invoice-wrapper">
	
	<!-- Invoice Header -->
	<div class="invoice-header">
		<h1 class="invoice-title">
			<i class="fas fa-file-invoice"></i>
			INVOICE
				{% if invoice.is_gst %}
					{{invoice.invoice_number}}
				{% else %}
					INV-{{invoice.invoice_number}}
				{% endif %}
		</h1>
		<div class="invoice-meta">
			<div class="meta-item">
				<i class="fas fa-calendar-alt"></i>
				<span><strong>Date:</strong> {{invoice.invoice_date}}</span>
			</div>
		</div>
	</div>

	<!-- Invoice Body -->
	<div class="invoice-body">
		
		<!-- Party Details -->
		<div class="row">
			<div class="col-md-6 mb-4">
				<h6 class="section-title">
					<i class="fas fa-building"></i>
					From
				</h6>
				<div class="party-details">
					<strong>{{user_profile.business_title}}</strong>
					<div>{{user_profile.business_address}}</div>
					{% if user_profile.business_email %}
						<div><i class="fas fa-envelope"></i> {{user_profile.business_email}}</div>
					{% endif %}
					{% if user_profile.business_phone %}
						<div><i class="fas fa-phone"></i> {{user_profile.business_phone}}</div>
					{% endif %}
					{% if user_profile.business_gst and invoice.is_gst %}
						<div><i class="fas fa-receipt"></i> GST: {{user_profile.business_gst}}</div>
					{% endif %}
				</div>
			</div>

			<div class="col-md-6 mb-4">
				<h6 class="section-title">
					<i class="fas fa-user"></i>
					Billed To
				</h6>
				<div class="party-details">
					<strong>{{ invoice_data.customer_name }}</strong>
					<div>{{ invoice_data.customer_address }}</div>
					<div><i class="fas fa-phone"></i> {{ invoice_data.customer_phone }}</div>
					{% if invoice.is_gst %}
						<div><i class="fas fa-receipt"></i> GST: {{ invoice_data.customer_gst }}</div>
					{% endif %}
					{% if invoice_data.vehicle_number %}
						<div><i class="fas fa-car"></i> <strong>Vehicle:</strong> {{ invoice_data.vehicle_number }}</div>
					{% endif %}
				</div>
			</div>
		</div>

		<!-- Items Table -->
		<h6 class="section-title mt-4">
			<i class="fas fa-list"></i>
			Invoice Items
		</h6>
		
		<div class="table-responsive-sm">
			<table class="table table-invoice">
				<thead>
						<tr>
							<th class="text-center">#</th>
							<th class="text-left">Model No</th>
							<th class="text-center">Item</th>
							<th class="text-center">HSN / SAC</th>


							<th class="text-center">Rate</th>
							<th class="text-center">Discount</th>

							<th class="text-right">Qty</th>
							<th class="text-right">Discounted Rate ({{ currency }})</th>
							<th class="text-right">Taxable Amount ({{ currency }})</th>
							<th class="text-right">GST (%)</th>
							{% if invoice_data.igstcheck %}
								<th class="text-right">IGST ({{ currency }})</th>
							{% else %}
								<th class="text-right">CGST ({{ currency }})</th>
								<th class="text-right">SGST ({{ currency }})</th>
							{% endif %}
							<th class="text-right">Total Amount ({{ currency }})</th>

						</tr>
					</thead>
					<tbody>
						{% for item in invoice_data.items %}
						<tr>
							<td class="text-center">{{ forloop.counter }}</td>
							<td class="text-left strong">{{ item.invoice_model_no }}</td>
							<td class="text-center">{{ item.invoice_product }}</td>
							<td class="text-center">{{ item.invoice_hsn }}</td>

							<td class="text-center">{{ item.invoice_rate_with_gst }}</td>
							<td class="text-center">{{ item.invoice_discount }}%</td>

							<td class="text-right">{{ item.invoice_qty }}</td>
							<td class="text-right">{{ item.invoice_rate_without_gst|floatformat:2 }}</td>
							<td class="text-right">{{ item.invoice_amt_without_gst|floatformat:2 }}</td>
							<td class="text-right">{{ item.invoice_gst_percentage }} %</td>
							{% if invoice_data.igstcheck %}
								<td class="text-right">{{ item.invoice_amt_igst|floatformat:2 }}</td>
							{% else %}
								<td class="text-right">{{ item.invoice_amt_cgst|floatformat:2 }}</td>
								<td class="text-right">{{ item.invoice_amt_sgst|floatformat:2 }}</td>
							{% endif %}
							<td class="text-right">{{ item.invoice_amt_with_gst|floatformat:2 }}</td>
						</tr>
						{% endfor %}

						<tr id="table-invoice-total-row">
							{% if invoice_data.igstcheck %}
								<td class="text-right" colspan="8">Total: </td>
								<td class="text-right">{{ currency }} {{ invoice_data.invoice_total_amt_without_gst|floatformat:2 }}</td>
								<td class="text-right"></td>
								<td class="text-right">{{ currency }} {{invoice_data.invoice_total_amt_igst|floatformat:2 }}</td>
							{% else %}
								<td class="text-right" colspan="8">Total: </td>
								<td class="text-right">{{ currency }} {{ invoice_data.invoice_total_amt_without_gst|floatformat:2 }}</td>
								<td class="text-right"></td>
								<td class="text-right">{{ currency }} {{invoice_data.invoice_total_amt_cgst|floatformat:2 }}</td>
								<td class="text-right">{{ currency }} {{invoice_data.invoice_total_amt_sgst|floatformat:2 }}</td>
							{% endif %}
							<td class="text-right"><strong>{{ currency }} {{ invoice_data.invoice_total_amt_with_gst|floatformat:2 }}</strong></td>
						</tr>

				</tbody>
			</table>
		</div>

		<!-- Bank Details & Grand Total -->
		<div class="row mt-4">
			<div class="col-md-6 mb-4">
				{% if user_profile.bankdetails %}
					<h6 class="section-title">
						<i class="fas fa-university"></i>
						Bank Details
					</h6>
					<table class="table table-bordered bank-details-table">
							<!-- <tr><th colspan="2" class="text-center">Bank Details</th></tr> -->
							<tr>
								<td>Account Name</td>
								<td>
									{% if user_profile.bankdetails.account_name %}
										{{ user_profile.bankdetails.account_name }}
									{% else %}
										-
									{% endif %}	
								</td>
							</tr>
							<tr>
								<td>Account Number</td>
								<td>
									{% if user_profile.bankdetails.account_number %}
										{{ user_profile.bankdetails.account_number }}
									{% else %}
										-
									{% endif %}
								</td>	
							</tr>
							<tr>
								<td>Bank Name</td>
								<td>
									{% if user_profile.bankdetails.bank_name %}
										{{ user_profile.bankdetails.bank_name }}
									{% else %}
										-
									{% endif %}
								</td>
							</tr>
							<tr>
								<td>IFSC Code</td>
								<td>
									{% if user_profile.bankdetails.ifsc_code %}
										{{ user_profile.bankdetails.ifsc_code }}
									{% else %}
										-
									{% endif %}
								</td>
							</tr>
							<tr>
								<td>Branch</td>
								<td>
									{% if user_profile.bankdetails.branch_name %}
										{{ user_profile.bankdetails.branch_name }}
									{% else %}
										-
									{% endif %}
								</td>
							</tr>
							{% if user_profile.bankdetails.upi_id %}
								<tr>
									<td colspan="2" class="text-center">
									<a href="upi://pay?pa={{ user_profile.bankdetails.upi_id }}&am={{invoice_data.invoice_total_amt_with_gst|floatformat:2 }}&cu=INR" 
									   style="display: inline-block; text-decoration: none; cursor: pointer;"
									   onclick="haptic.light();">
										<div id="upi_qr" style="margin: 10px auto;" data-upi_id="upi://pay?pa={{ user_profile.bankdetails.upi_id }}&am={{invoice_data.invoice_total_amt_with_gst|floatformat:2 }}"></div>
										<div style="margin-top: 8px; font-size: 12px; color: #667eea; font-weight: 600;">
											<i class="fas fa-mobile-alt"></i> Tap to Pay
										</div>
									</a>
									</td>
								</tr>
							{% endif %}
						</table>
					{% endif %}
				</div>
			
			<div class="col-md-6">
				<h6 class="section-title">
					<i class="fas fa-calculator"></i>
					Grand Total
				</h6>
				<table class="table" id="invoice-grand-total-table">
						<tr>
							<td>Total Taxable Amount: </td>
							<td>{{ currency }} {{ invoice_data.invoice_total_amt_without_gst|floatformat:2 }}</td>
						</tr>
						{% if invoice_data.igstcheck %}
							<tr>
								<td>IGST: </td>
								<td>{{ currency }} {{ invoice_data.invoice_total_amt_igst|floatformat:2 }}</td>
							</tr>
						{% else %}
							<tr>
								<td>CGST: </td>
								<td>{{ currency }} {{ invoice_data.invoice_total_amt_cgst|floatformat:2 }}</td>
							</tr>
							<tr>
								<td>SGST: </td>
								<td>{{ currency }} {{ invoice_data.invoice_total_amt_sgst|floatformat:2 }}</td>
							</tr>
						{% endif %}
						
						 <tr>
							<td>Invoice Total: </td>
							<td>{{ currency }} {{invoice_data.invoice_total_amt_with_gst|floatformat:2 }}</td>
						</tr>


						<tr> 
							<td colspan="2" class="text-middle">
								Invoice Total In Words: {{ total_in_words }} only.
							</td>
						</tr>
						<tr id="invoice-signature-row">
							<td colspan="2" style="padding-top: 80px;"></td>
						</tr>
						<tr id="invoice-signature-text-row">
							<td colspan="2">
								<strong>Authorized Signatory</strong><br>
								{{user_profile.business_title}}
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
	</div>

	<!-- Action Buttons -->
	<div class="action-buttons d-print-none">
		<button onclick="window.print(); haptic.medium();" class="btn-oneui btn-primary">
			<i class="fas fa-print"></i>
			Print Invoice
		</button>
		<a href="#"
			class="btn-oneui btn-danger"
			onclick="haptic.light(); window.history.back(); return false;">
			 <i class="fas fa-times"></i>
			 Close
		</a>
	</div>

</div>

<script>
	// Haptic feedback fallback
	if (typeof haptic === 'undefined') {
		window.haptic = {
			light: () => {},
			medium: () => {},
			heavy: () => {}
		};
	}
</script>

{% endblock %}
{% block includejs %}
<script src="https://unpkg.com/qr-code-styling/lib/qr-code-styling.js"></script>
<script>
    const upiQR = document.getElementById("upi_qr").getAttribute("data-upi_id");
    const qr = new QRCodeStyling({
        width: 100,
        height: 100,
        data: upiQR,
        dotsOptions: { color: "#000", type: "rounded" }
    });

    qr.append(document.getElementById("upi_qr"));
</script>
{% endblock %}