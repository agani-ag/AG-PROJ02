{% extends "base.html" %}

{% load static %}
{% load humanize %}
{% block content %}

	{% if messages %}
		{% for message in messages %}
			<div class="alert {% if message.tags == 'success' %} alert-success
			{% elif message.tags == 'error' %} alert-danger {% else %} alert-primary {% endif %}" style="margin-bottom: 0%;">
			<p>{{ message }}</p></div>
		{% endfor %}
	{% endif %}

	<h2>Purchases</h2>
	<hr>
		<div class="row">
			<div class="col">
				<h3>
					Purchased: 
						<span class="font-weight-bold text-danger">₹ {{ total_p | default:0 | intcomma }}</span>
				</h3>
				<h3>
					Paid: 
						<span class="font-weight-bold text-success">₹ {{ total_pp | default:0 | intcomma }}</span>
				</h3>
				<h3>
					Balance: 
						<mark class="text-dark" style="background-color: rgba(255, 255, 0, 0.350); padding: 0.1em 0.4em; border-radius: 0.2em;">
							<span class="font-weight-bold">₹ {{ total_pb | default:0 | intcomma }}</span>
						</mark>
				</h3>
			</div>

			<div class="col text-right" style="padding-top: 0.5%;">
				<a href="{% url 'purchases_add' %}" class="btn btn-primary btn-sm btn-curve">
					<i class="fas fa-plus"></i>
				</a>
				<a href="{% url 'feature_upload' %}" class="btn btn-success btn-sm btn-curve">
					<i class="fas fa-file-excel"></i>
				</a>
			</div>
		</div>

		<table class="table table-hover font-weight-bold" id="purchase-table">
		<thead class="thead-dark">
			<tr>
				<th>Date</th>
				<th>Type</th>
				<th>Amount</th>
				<th>Status</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody class="two-col-form">
			{% for purchase in purchases %}
			<tr class="{% if purchase.amount > 0 %} table-success {% else %} table-danger {% endif %}">
 				<td>{{purchase.date}}</td>
				<td>{{purchase.get_ptype_display }}</td>
				<td>{% if purchase.amount %}₹ {{purchase.amount}}{% else %}<span class="text-muted">N/A</span>{% endif %}</td>
				<td>{{purchase.get_status_display}}</td>
				<td>
					<div class="btn-group" role="group" aria-label="Basic example">
						<a href="{% url 'purchases_edit' purchase.id %}" class="btn btn-primary btn-sm btn-curve"><i class="fas fa-edit"></i></a>
						<a href="{% url 'purchases_delete' purchase.id %}" class="btn btn-danger btn-sm btn-curve"><i class="fas fa-trash"></i></a>
					</div>
				</td>
			</tr>
			{% endfor %}
		</tbody>
		</table>
{% endblock %}


{% block includejs %}
<script type="text/javascript">
	$(document).ready( function () {
		$('#purchase-table').DataTable({
			"order": [],
			"columnDefs": [ {
				"targets": 3,
				"sortable": false,
				"searchable": false
			} ],
			"paging": true
		});
	});
</script>
{% endblock %}
