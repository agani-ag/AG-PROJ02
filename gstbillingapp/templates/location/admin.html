<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Admin Dashboard</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

<style>
#map { height: 80vh; }
</style>
</head>

<body>

<nav class="navbar navbar-dark bg-dark">
  <span class="navbar-brand ms-3">ðŸ§  Admin Control Panel</span>
</nav>

<div class="container-fluid mt-2">
  <div id="map"></div>
  <div id="alerts" class="mt-2"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
const API_POLL = "/api/location/poll/";
const API_EVENTS = "/api/location/geofence/";

const map = L.map("map").setView([0,0],2);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

let heat = L.heatLayer([], {radius:25}).addTo(map);

// -------- POLL ALL LOCATIONS --------
setInterval(()=>{
 fetch(API_POLL)
 .then(r=>r.json())
 .then(data=>{
   data.forEach(p=>{
     heat.addLatLng([p.lat,p.lng,0.6]);
   });
 });
},1000);

// -------- POLL GEOFENCE EVENTS --------
setInterval(()=>{
 fetch(API_EVENTS)
 .then(r=>r.json())
 .then(events=>{
   events.forEach(e=>{
     document.getElementById("alerts").innerHTML +=
       `<div class="alert alert-warning">
         ${e.user} ${e.event} ${e.fence}
        </div>`;
   });
 });
},1000);
</script>

</body>
</html>
