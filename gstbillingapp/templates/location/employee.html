<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<style>#map{height:85vh}</style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<script>
const map = L.map("map").setView([0,0],2);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
let heat = L.heatLayer([], {radius:25}).addTo(map);
let last=null;

setInterval(()=>{
 let url="/api/location/poll/?user_type=customer";
 if(last) url+="&since="+last;
 fetch(url).then(r=>r.json()).then(d=>{
  d.forEach(p=>{
   last=p.time;
   heat.addLatLng([p.lat,p.lng,0.6]);
  })
 })
},1000);
</script>
</body>
</html>
